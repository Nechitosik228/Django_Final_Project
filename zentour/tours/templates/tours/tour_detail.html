{% extends 'tours/base.html' %}
{% load static %}

{% block title %}{{ tour.name }}{% endblock %}

{% block style %}
    <style type="text/css">
        .image {
        float: left;
        width: 50%;
        height: 30%;
        margin-right: 30px;
        position: sticky;
        top: 0;
        }

        .text-success {
            font-size: 50px;  
        }

        p {
            font-size: 20px;
        }

        span {
            font-size: 25px;
        }

        .checked {
            color: orange;
        }

        .fa {
            width: 10px;
        }
        
        .tour {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .white {
            color: white;
        }

        .btn {
            margin-top: 10px;
        }
    </style>
{% endblock %}

{% block content %}

    <div class="tour">
        <img src="{{ tour.image.url|default:'https://fotografie.at/galerie/userImages/33/484922-33adeea9.jpg' }}" alt="{{ tour.name }}" class="image">
        <div class="card text-bg-primary mb-3 tour-text">
            <h1 class="card-header white">{{ tour.name }}</h1>
            <div class="card-body">
                <p class="card-text white">{{ tour.description }}</p>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">üìÖ Dates: {{ tour.start_date }} - {{ tour.end_date }}</li>
                    {% if tour.available %}
                        <li class="list-group-item">üé´Tickets left: {{ tour.tickets_amount }}</li>
                    {% else %}
                        <li class="list-group-item"><strong>‚ùå Sold out</strong></li>
                    {% endif %}
                    <li class="list-group-item">üè¢ Cities: {{ tour.cities }}</li>
                    {% if tour.rating  %}
                        <li>
                            {% for _ in full_stars %}
                                <span class="fa fa-star checked"></span>
                            {% endfor %}
                            {% if has_half_star %}
                                <span class="fa fa-star-half-o checked"></span>
                            {% endif %}
                            {% for _ in empty_stars %}
                                <span class="fa fa-star-o"></span>
                            {% endfor %}
                            <span>{{ tour.rating }}</span>
                        </li>
                    {% endif %}
                    {% if tour.discount %}
                        <li class="list-group-item">
                        <span class="text-success">
                            Ticket price: ${{ tour.discount_price }}
                        </span>
                        <span class="text-muted text-decoration-line-through">
                            ${{ tour.price }}
                        </span>
                        <span>
                            Discount: {{ tour.discount }}%
                        </span>
                        </li>
                    {% else %}
                        <li class="list-group-item text-success">
                            Ticket price: ${{ tour.price }}
                        </li>  
                    {% endif %}
                </ul>
                {% if tour.available %}
                    <a href="{% url 'tours:cart_add' tour.id%}" class="btn btn-success">Add to Cart!</a>
                {% endif %}
            </div>
                <div class="reviews">

                    {% if user.is_authenticated %}
                        <hr>
                        <h2>Leave a review</h2>
                        <form method="POST" action="{% url 'tours:submit_review' tour.id %}">
                            {% csrf_token %}
            
                            {{ form.comment.label_tag }}
                            {{ form.comment }}
            
                            <label for="star-rating">Rating (1‚Äì5):</label>
                            <div id="star-rating">
                                {% for i in "12345" %}
                                    <span class="fa fa-star star" data-value="{{ forloop.counter }}"></span>
                                {% endfor %}
                            </div>
            
                            {% with form.rating as rating_field %}
                                {{ rating_field }}
                                <style>
                                    input[name="{{ rating_field.html_name }}"] {
                                        display: none;
                                    }
                                </style>
                            {% endwith %}
            
            
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                        {% else %}
                        <p><a href="{% url 'accounts:login' %}?next={{ request.path }}">Log in</a> to leave a review.</p>
                    {% endif %}
                    
                    <hr>
                    <h2>Reviews</h2>
                    {% for review in tour.reviews.all %}
                        <div style="margin-bottom: 20px;">
                            <p><strong>{{ review.user.username }}</strong> rated:</p>
                            {% for _ in review.full_stars %}
                                <span class="fa fa-star checked"></span>
                            {% endfor %}
                            {% if review.has_half_star %}
                                <span class="fa fa-star-half-o checked"></span>
                            {% endif %}
                            {% for _ in review.empty_stars %}
                                <span class="fa fa-star"></span>
                            {% endfor %}
                            <p>{{ review.comment }}</p>
                        </div>
                    {% empty %}
                        <p>No reviews yet.</p>
                    {% endfor %}
                </div>
    <script src="{% static 'js/review_star.js' %}"></script>
{% endblock %}